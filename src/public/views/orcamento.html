<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Produto</title>

  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-custom px-4">
    <a class="navbar-brand" href="#"><i class="bi bi-house-fill"></i></a>
    <div class="ms-auto">
      <a href="#" class="nav-link d-inline">Gerar Orçamento</a>
      <a href="#" class="nav-link d-inline">Sair</a>
    </div>
  </nav>

  <div class="container d-flex justify-content-center align-items-center flex-grow-1">
    <div class="card card-custom p-4 col-md-6">
      <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="produto-tab" data-bs-toggle="tab" data-bs-target="#produto" type="button"
            role="tab">Produto</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="servico-tab" data-bs-toggle="tab" data-bs-target="#servico" type="button"
            role="tab">Serviço</button>
        </li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="produto" role="tabpanel">
          <form id="form-produto" action="/api/orcamentos" method="POST">
            <div class="row mb-3">
              <div class="col">
                <label class="form-label">Nome do Produto*</label>
                <input type="text" class="form-control" name="nomeProduto" placeholder="Digite o nome" required>
              </div>
              <div class="col">
                <label class="form-label">Custo de Produção (R$)*</label>
                <input type="number" class="form-control" name="custoProducao" placeholder="0,00" min="0" step="0.01"
                  required>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col">
                <label class="form-label">Materiais Utilizados*</label>
                <input type="text" class="form-control" name="materiaisUtilizados" placeholder="Ex.: Madeira, Cola..."
                  required>
              </div>
              <div class="col">
                <label class="form-label">Margem de Lucro (%)*</label>
                <input type="number" class="form-control" name="margemLucro" placeholder="10" min="0" step="0.1"
                  required>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col">
                <label class="form-label">Horas Estimadas*</label>
                <input type="number" class="form-control" name="horas" placeholder="Ex.: 2" min="0" step="0.25"
                  required>
              </div>
              <div class="col">
                <label class="form-label">Valor Hora (R$)*</label>
                <input type="number" class="form-control" name="valorHora" placeholder="0,00" min="0" step="0.01"
                  required>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Custo Extra (R$)</label>
              <input type="number" class="form-control" name="custoExtra" placeholder="0,00" min="0" step="0.01">
            </div>
            <div class="mb-3">
              <label class="form-label">Resposta/Observação</label>
              <textarea class="form-control" rows="2" name="resposta" placeholder="Observações"></textarea>
            </div>
            <button type="submit" class="btn btn-vivo btn-elevate w-100">Calcular Produto</button>
          </form>
        </div>

        <div class="tab-pane fade" id="servico" role="tabpanel">
          <form id="form-servico" action="/api/orcamentos" method="POST">
            <div class="mb-3">
              <label class="form-label">Nome do Serviço*</label>
              <input type="text" class="form-control" name="nomeServico" placeholder="Digite o serviço" required>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Valor Base (R$)*</label>
                <input type="number" class="form-control" name="valorBase" placeholder="0,00" min="0" step="0.01"
                  required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Horas Estimadas (h)*</label>
                <div class="input-group">
                  <input type="number" class="form-control" name="horasEstimadas" placeholder="Ex.: 1.5" min="0"
                    step="0.25" required>
                  <span class="input-group-text">h</span>
                </div>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Materiais Utilizados*</label>
              <input type="text" class="form-control" name="materiaisServico" placeholder="Ex.: Tinta, Ferramentas..."
                required>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Custo (R$)*</label>
                <input type="number" class="form-control" name="custoServico" placeholder="0,00" min="0" step="0.01"
                  required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Lucro (%)*</label>
                <input type="number" class="form-control" name="lucroServico" placeholder="10" min="0" step="0.1"
                  required>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Descrição</label>
              <textarea class="form-control" rows="3" name="descricaoServico"
                placeholder="Detalhes do serviço"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Resposta/Observação</label>
              <textarea class="form-control" rows="2" name="respostaServico" placeholder="Observações"></textarea>
            </div>
            <button type="submit" class="btn btn-vivo btn-elevate w-100">Calcular Serviço</button>
          </form>
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.querySelectorAll('form').forEach(form => {
      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        const dados = Object.fromEntries(new FormData(this));

        try {
          // Envia dados para a nova rota que salva no banco
          const resposta = await fetch('/api/orcamentos', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(dados)
          }).then(r => r.json());

          // Redireciona para a página de visualização, passando o ID do orçamento na URL
          window.location.href = `/src/public/views/visualizarOrcamento.html?id=${resposta.orcamentoId}`;
        } catch (err) {
          alert('Erro ao gerar orçamento. Tente novamente.');
        }
      });
    });
  </script>
</body>

</html>